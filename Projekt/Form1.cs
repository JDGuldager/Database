using System.Data.SqlClient;
using System.Data;

namespace Projekt
{
    public partial class Form1 : Form
    {
        // Private = Kan benyttes inden i alle metoderne i koden, også void
        private int autoID = 1;
        private int autoTwo = 30;
        private string path = @"c:\Jeppe-Leif-Nathalie-Parking\Database.txt";
        private string appendText = "";
        public Form1() //Starter GUI
        {
            InitializeComponent();
            //Gemmer næste knappen
            næsteKnap.Enabled = false;
            næsteKnap.Visible = false;
        }
        private void gemKnap_Click(object sender, EventArgs e) //Metode der kører når jeg trykker på gem knappen i programmet
        {
            //Laver en mappe hvor jeg kan putte database textfilen ind
            Directory.CreateDirectory(@"c:\Jeppe-Leif-Nathalie-Parking");
            // Hvis ikke der er påbegynt en database, laver denne kode en ny fil på ovenstående destination
            if (!File.Exists(path))
            {
                string[] createText = { "" };
                File.WriteAllLines(path, createText);
            }
            // Tjekker om passwordet er mere eller mindre end 8 cifre
            if (telBox.Text.Length < 8 || telBox.Text.Length > 8)
            {
                MessageBox.Show("Mobilnummer skal indeholde 8 cifre (Ingen landekoder)");
                telBox.Text = "";
            }
            // Tjekker om alle de nødvendige textbokse er udfyldt, ellers gemmer den ikke informationerne
            else if (forNavnBox.Text == "" || efterNavnBox.Text == "" || adresseBox.Text == "" || postnrBox.Text == "" || byBox.Text == "" || telBox.Text == "")
            {
                MessageBox.Show("Udfyld venligst alle nødvendige informationer");
                clear();
            }
            else
            {
                // Hvis der er indskrevet lejlighed nr. gemmer den brugerinformationern
                if (lejBox.Text == "")
                {
                    appendText = forNavnBox.Text + ", " + efterNavnBox.Text + ", " + adresseBox.Text + ", " + postnrBox.Text + ", " + byBox.Text + ", " + telBox.Text + Environment.NewLine;
                }
                // Gemmer brugerinformationerne hvis alle de nødvendige felter er udfyldt
                else
                {
                    appendText = forNavnBox.Text + ", " + efterNavnBox.Text + ", " + adresseBox.Text + ", " + lejBox.Text + ", " + postnrBox.Text + ", " + byBox.Text + ", " + telBox.Text + Environment.NewLine;
                }
                // Sender informationen til textfil
                File.AppendAllText(path, appendText);
                MessageBox.Show("Dine oplysninger er nu gemt i databasen");
                //Benytter mig af nedenstående metode
                clear();
            }

        }
        public void clear() //Metode til at clear textboxene i applicationen efter en bruger har indtastet sine oplysninger
        {
            forNavnBox.Text = "";
            efterNavnBox.Text = "";
            adresseBox.Text = "";
            postnrBox.Text = "";
            byBox.Text = "";
            lejBox.Text = "";
            telBox.Text = "";
            søgBox.Text = "";
        }
        public void visKnap_Click(object sender, EventArgs e) //Metode til at udprinte de 0 - 15 personer til side 1 i databasen
        {
            // Gemmer vis knappen efter den er blevet brugt og viser næste 15 knap for at undgå at brugeren laver fejl
            visKnap.Enabled = false;
            visKnap.Visible = false;
            næsteKnap.Enabled = true;
            næsteKnap.Visible = true;
            int counter = 0;
            // Indlæser alt data fra textfilen
            string[] readData = File.ReadAllLines(path);
            // Sætter autoID og autoTwo til deres originale værdier så brugeren kan benytte sig af 0-15 personer knappen igen og igen
            this.autoID = 1;
            this.autoTwo = 30;
            // Clearer den hvide datakasse for info
            dataKomplet.Clear();
            // Læser hvor mange linjer der er i filen
            foreach (string line in File.ReadLines(path))
            {
                counter++;
            }
            MessageBox.Show("Der er " + counter + " personer i databasen");
            // tilføjer tekst og colums til den hvide databox
            dataKomplet.Columns.Add("NR", 40, HorizontalAlignment.Center);
            dataKomplet.Columns.Add("Data", 530, HorizontalAlignment.Center);
            // this betyder at vi kan benytte os af værdien uden for void metoden
            int dataNum = 0;

            do
            {
                // Benytter mig af nedenstående metode
                addDataToList(readData[dataNum]);
                // Plus 1 til dataNum
                dataNum++;
            }
            // bliver ved indtil vi har data fra 1-15
            while (dataNum < counter && dataNum < 15);
        }
        public void addDataToList(string Data) // Metode til at tilføje informationen fra filen til den hvide databox
        {
            // ListViewItem (en genstand der skal puttes ind i den hvide databox)
            // eachrow laver en ny linje - Putter autoID ind fordi det er det nummer som skal stå til venstre for vores data
            ListViewItem eachrow = new ListViewItem("" + autoID);
            // Indsætter vores data til venstre for det ID dataen har fået
            ListViewItem.ListViewSubItem info = new ListViewItem.ListViewSubItem(eachrow, Data);
            // De to nedenstående linjer sender dataen til den hvide databox
            eachrow.SubItems.Add(info);
            dataKomplet.Items.Add(eachrow);
            // autoID skal +1 så vi ikke tildeler den samme værdi flere gange
            // Igen 'this.autoID' fordi den skal kunne benyttes udenfor vores void metode
            this.autoID++;
        }

        private void søgKnap_Click(object sender, EventArgs e) // Metode til når vi trykker på 'Søg'
        {
            // Gemmer næste knap og viser 1-15 knap
            næsteKnap.Enabled = false;
            næsteKnap.Visible = false;
            visKnap.Enabled = true;
            visKnap.Visible = true;
            // Definerer search som det brugeren har indtastet i tekstboksen
            string search = søgBox.Text;
            // Sætter ID til 1 så vi kan se hvor mange resultater vi får
            this.autoID = 1;
            // Clearer den hvide databox
            dataKomplet.Clear();
            // Foreach lække så den taker alle linjer som indeholder søgekriteriet, og ikke kun den første linje
            foreach (var line in File.ReadLines(path))
            {
                // Hvis den indeholder søgekriteriet:
                if (line.Contains(search))
                {
                    dataKomplet.Columns.Add("NR", 40, HorizontalAlignment.Center);
                    dataKomplet.Columns.Add("Data", 530, HorizontalAlignment.Center);
                    // Metoden fra tidligere genbrugt
                    addDataToList(line);
                }
            }
        }
        private void næsteKnap_Click(object sender, EventArgs e) //Metode til at trykke næste 15 personer i databasen 
        {
            string[] readData = File.ReadAllLines(path);
            int counter = 0;
            // Clear den hvide databox
            dataKomplet.Clear();
            // Vi antager at brugeren har trykket 0-15 først, så vi sætter ikke vores værdier tilbage
            foreach (string line in File.ReadLines(path))
            {
                counter++;
            }
            dataKomplet.Columns.Add("NR", 40, HorizontalAlignment.Center);
            dataKomplet.Columns.Add("Data", 530, HorizontalAlignment.Center);
            // Sætter dataNum til autoID værdi og -1 (Fordi det første vi gør er at +1 i vores do while løkke)
            int dataNum = autoID - 1;
            do
            {
                // Metode fra tidligere
                addDataToList(readData[dataNum]);
                dataNum++;
            }
            // Fortsætter vores løkke indtil dataNum er = autoTwo (30)
            while (dataNum < counter && dataNum < autoTwo);
            // føjer +15 til autoTwo så næste gang vi trykker kører lykken til 45 og så 60 osv.
            autoTwo = autoTwo + 15;
            // Hvis der ikke er 15 personer i databasen at tilføje giver vi brugeren en meddelelse:
            if (counter == dataNum)
            {
                MessageBox.Show("Enden af databasen");
                // Gemmer næste knap og viser 1-15 knap
                næsteKnap.Enabled = false;
                næsteKnap.Visible = false;
                visKnap.Enabled = true;
                visKnap.Visible = true;
            }
        }
    }
}
